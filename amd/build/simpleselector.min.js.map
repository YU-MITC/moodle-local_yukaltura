{"version":3,"file":"simpleselector.min.js","sources":["../src/simpleselector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Simple Secctor script for kaltura media embed.\n *\n * @copyright (C) 2016-2025 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module local_yukaltura/simpleselector\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initial function.\n         * @access public\n         * @param {string} selectorUrl - url of simple selector page.\n         * @param {string} replaceLabel - label of media replace button.\n         */\n        init: function(selectorUrl, replaceLabel) {\n\n            var modalX = 0;\n            var modalY = 0;\n            var timer = false;\n\n            /**\n             * This function reflects change of sort option.\n             * @access public\n             */\n            function changeSort() {\n                // Get url.\n                var url = $(\"#selectorSort\").val();\n                // Change url of selector window.\n                location.href = url;\n            }\n\n            /**\n             * This is callback function for thumbnail click.\n             * @access public\n             * @param {object} e - event object of target image.\n             */\n            function clickThumbnailImage(e) {\n                var selectId = e.target.id;\n                var selectName = e.target.alt;\n                var selectThumbnail = e.target.src;\n\n                selectThumbnail = selectThumbnail.replace(/width\\/\\d+/g, \"width/150\");\n                selectThumbnail = selectThumbnail.replace(/height\\/\\d+/g, \"height/100\");\n\n                // Set entry id of selected media.\n                $(\"#select_id\").val(selectId);\n                // Set name of selected media.\n                $(\"#select_name\").html(selectName);\n                // Set thumbnail of selected media.\n                $(\"#select_thumbnail\").val(selectThumbnail);\n\n                // Enable OK button.\n                $(\"#submit_btn\").prop(\"disabled\", false);\n                $(\"#submit_btn\").css({opacity: \"1.0\"});\n            }\n\n            /**\n             * This function centerize modal window.\n             * @access public\n             * @param {object} contentPanel - HTML element of content panel.\n             */\n            function centeringModalSyncer(contentPanel) {\n                if (timer !== false) {\n                    clearTimeout(timer);\n                }\n                timer = setTimeout(function() {\n                    // Get width and height of window.\n                    var w = $(window).width();\n                    var h = $(window).height();\n\n                    // Get width and height of modal content.\n                    var cw = $(contentPanel).outerWidth();\n                    var ch = $(contentPanel).outerHeight();\n\n                    // Execute centering of modal window.\n                    $(contentPanel).css({\"left\": ((w - cw) / 2) + \"px\", \"top\": ((h - ch) / 2) + \"px\"});\n                }, 200);\n            }\n\n            /**\n             * This function print modal window.\n             * @access public\n             * @param {string} url - URL of simple selector web page.\n             * @return {bool} - if fade-in modal window, return true.\n             */\n            function fadeInSelectorWindow(url) {\n                // Avoidance of duplicatable execute.\n                $(this).blur(); // Unfocus base window.\n                if ($(\"#modal_window\")[0]) {\n                    return false;\n                }\n\n                // Save scroll position of base window.\n                var dElm = document.documentElement;\n                var dBody = document.body;\n                modalX = dElm.scrollLeft || dBody.scrollLeft; // X value of current position.\n                modalY = dElm.scrollTop || dBody.scrollTop; // Y value of current position.\n                // Print ovaerlay.\n                $(\"body\").append(\"<div id=\\\"selector_content\\\"></div>\");\n                $(\"body\").append(\"<div id=\\\"modal_window\\\"></div>\");\n                $(\"#modal_window\").fadeIn(\"slow\");\n\n                // Centering content.\n                centeringModalSyncer(\"#selector_content\");\n                // Fade-in content.\n                $(\"#selector_content\").fadeIn(\"slow\");\n                // Set url of content.\n                $(\"#selector_content\").html(\"<iframe src=\\\"\" + url + \"\\\" width=\\\"100%\\\" height=\\\"100%\\\">\");\n\n                // Cntering content.\n                centeringModalSyncer(\"#selector_content\");\n\n                $(parent.window).resize(function() {\n                    centeringModalSyncer(\"#selector_content\");\n                });\n\n                return true;\n            }\n\n            /**\n             * This function delete modal window.\n             * @access public\n             */\n            function fadeOutSelectorWindow() {\n\n                // Restore scroll position of base window.\n                window.scrollTo(modalX, modalY);\n\n                // Fade-out and delete modal contet and modal window.\n                $(\"#modal_window\", parent.document).fadeOut(\"slow\");\n                $(\"#modal_window\", parent.document).remove();\n                $(\"#selector_content\", parent.document).fadeOut(\"slow\");\n                $(\"#selector_content\", parent.document).remove();\n            }\n\n            /**\n             * This function is callback for OK button click.\n             * @access public\n             */\n            function selectorSubmitClick() {\n                // Get entry id of selected media.\n                var selectId = $(\"#select_id\").val();\n                // Get name of selected media.\n                var selectName = $(\"#select_name\").html();\n                // Get thumbnail of selected media.\n                var selectThumbnail = $(\"#select_thumbnail\").val();\n\n                if (selectId !== null && selectId !== \"\") {\n                    if ($(\"#entry_id\") !== null) {\n                        $(\"#entry_id\", parent.document).val($(\"#select_id\").val());\n                    }\n\n                    var idName = $(\"#id_name\", parent.document);\n\n                    if (idName !== null) {\n                        idName.val($(\"#select_name\").html());\n                    }\n\n                    var desc = \"\";\n\n                    var selectDesc = $(\"#description_\" + selectId);\n                    if (selectDesc !== null) {\n                        desc = selectDesc.html();\n                        desc = desc.replace(/\\n/g, \"<br />\");\n                    }\n\n                    desc = \"<p>\" + desc + \"<br /></p>\";\n\n                    var editor = $(\"#id_introeditoreditable\", parent.document);\n\n                    if (editor !== null) {\n                        if (desc !== null && desc !== \"\") {\n                            editor.html(desc);\n                        } else {\n                            editor.html(\"\");\n                        }\n                    }\n\n                    editor = $(\"#id_introeditor\", parent.document);\n\n                    if (editor !== null) {\n                        if (desc !== null && desc !== \"\") {\n                            editor.html(desc);\n                        } else {\n                            editor.html(\"\");\n                        }\n                    }\n\n                    if ($(\"#media_thumbnail\", parent.document) !== null) {\n                        $(\"#media_thumbnail\", parent.document).prop(\"src\", selectThumbnail);\n                        $(\"#media_thumbnail\", parent.document).prop(\"alt\", selectName);\n                        $(\"#media_thumbnail\", parent.document).prop(\"title\", selectName);\n                    }\n\n                    var idMediaProperties = $(\"#id_media_properties\", parent.document);\n                    if (idMediaProperties !== null) {\n                        idMediaProperties.css({visibility: \"visible\"});\n                    }\n\n                    var submitMedia = $(\"#submit_media\", parent.document);\n                    if (submitMedia !== null) {\n                        submitMedia.prop(\"disabled\", false);\n                    }\n\n                    // Fade-out modal windoiw.\n                    fadeOutSelectorWindow();\n                }\n            }\n\n            /**\n             * This function replaces \"Add Media\" label when membed media is selected.\n             * @access public\n             * @param {string} str - Label of \"Add Media\" button.\n             */\n            function replaceAddMediaLabel(str) {\n                $(\"#id_add_media\", parent.document).val(str);\n            }\n\n            $(\"#selectorSort\").on(\"change\", function() {\n                changeSort();\n            });\n\n            $(\"#id_add_media\").on(\"click\", function() {\n                fadeInSelectorWindow(selectorUrl);\n            });\n\n            $(\"#submit_btn\").on(\"click\", function() {\n                selectorSubmitClick();\n            });\n\n            $(\"#cancel_btn\").on(\"click\", function() {\n                fadeOutSelectorWindow();\n            });\n\n            $(\"#fadeout\").on(\"click\", function() {\n                fadeOutSelectorWindow();\n            });\n\n            if ($(location).attr(\"pathname\").indexOf(\"simple_selector.php\") != -1) {\n                $(\".media_thumbnail\").on(\"click\", function(e) {\n                    clickThumbnailImage(e);\n                });\n            } else {\n                $(\"#media_thumbnail\").on(\"change\", function() {\n                    replaceAddMediaLabel(replaceLabel);\n                });\n            }\n\n        }\n    };\n});\n"],"names":["define","$","init","selectorUrl","replaceLabel","modalX","modalY","timer","centeringModalSyncer","contentPanel","clearTimeout","setTimeout","w","window","width","h","height","cw","outerWidth","ch","outerHeight","css","fadeOutSelectorWindow","scrollTo","parent","document","fadeOut","remove","on","url","val","location","href","this","blur","dElm","documentElement","dBody","body","scrollLeft","scrollTop","append","fadeIn","html","resize","fadeInSelectorWindow","selectId","selectName","selectThumbnail","idName","desc","selectDesc","replace","editor","prop","idMediaProperties","visibility","submitMedia","selectorSubmitClick","attr","indexOf","e","target","id","alt","src","opacity","clickThumbnailImage","str"],"mappings":"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"}