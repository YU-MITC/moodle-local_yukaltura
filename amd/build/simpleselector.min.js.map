{"version":3,"sources":["../src/simpleselector.js"],"names":["define","$","init","selectorUrl","replaceLabel","modalX","modalY","timer","changeSort","url","val","location","href","clickThumbnailImage","e","selectId","target","id","selectName","alt","selectThumbnail","src","replace","html","prop","css","opacity","centeringModalSyncer","contentPanel","clearTimeout","setTimeout","w","window","width","h","height","cw","outerWidth","ch","outerHeight","fadeInSelectorWindow","blur","dElm","document","documentElement","dBody","body","scrollLeft","scrollTop","append","fadeIn","parent","resize","fadeOutSelectorWindow","scrollTo","fadeOut","remove","selectorSubmitClick","idName","desc","selectDesc","editor","idMediaProperties","visibility","submitMedia","replaceAddMediaLabel","str","on","attr","indexOf"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Simple Secctor script for kaltura media embed.\n *\n * @package    local_yukaltura\n * @copyright  (C) 2016-2020 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module local_yukaltura/simpleselector\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initial function.\n         * @access public\n         * @param {string} selectorUrl - url of simple selector page.\n         * @param {string} replaceLabel - label of media replace button.\n         */\n        init: function(selectorUrl, replaceLabel) {\n\n            var modalX = 0;\n            var modalY = 0;\n            var timer = false;\n\n            /**\n             * This function reflects change of sort option.\n             * @access public\n             */\n            function changeSort() {\n                // Get url.\n                var url = $(\"#selectorSort\").val();\n                // Change url of selector window.\n                location.href = url;\n            }\n\n            /**\n             * This is callback function for thumbnail click.\n             * @access public\n             * @param {object} e - event object of target image.\n             */\n            function clickThumbnailImage(e) {\n                var selectId = e.target.id;\n                var selectName = e.target.alt;\n                var selectThumbnail = e.target.src;\n\n                selectThumbnail = selectThumbnail.replace(/width\\/\\d+/g, \"width/150\");\n                selectThumbnail = selectThumbnail.replace(/height\\/\\d+/g, \"height/100\");\n\n                // Set entry id of selected media.\n                $(\"#select_id\").val(selectId);\n                // Set name of selected media.\n                $(\"#select_name\").html(selectName);\n                // Set thumbnail of selected media.\n                $(\"#select_thumbnail\").val(selectThumbnail);\n\n                // Enable OK button.\n                $(\"#submit_btn\").prop(\"disabled\", false);\n                $(\"#submit_btn\").css({opacity: \"1.0\"});\n            }\n\n            /**\n             * This function centerize modal window.\n             * @access public\n             * @param {object} contentPanel - HTML element of content panel.\n             */\n            function centeringModalSyncer(contentPanel) {\n                if (timer !== false) {\n                    clearTimeout(timer);\n                }\n                timer = setTimeout(function() {\n                    // Get width and height of window.\n                    var w = $(window).width();\n                    var h = $(window).height();\n\n                    // Get width and height of modal content.\n                    var cw = $(contentPanel).outerWidth();\n                    var ch = $(contentPanel).outerHeight();\n\n                    // Execute centering of modal window.\n                    $(contentPanel).css({\"left\": ((w - cw) / 2) + \"px\", \"top\": ((h - ch) / 2) + \"px\"});\n                }, 200);\n            }\n\n            /**\n             * This function print modal window.\n             * @access public\n             * @param {string} url - URL of simple selector web page.\n             * @return {bool} - if fade-in modal window, return true.\n             */\n            function fadeInSelectorWindow(url) {\n                // Avoidance of duplicatable execute.\n                $(this).blur(); // Unfocus base window.\n                if ($(\"#modal_window\")[0]) {\n                    return false;\n                }\n\n                // Save scroll position of base window.\n                var dElm = document.documentElement;\n                var dBody = document.body;\n                modalX = dElm.scrollLeft || dBody.scrollLeft; // X value of current position.\n                modalY = dElm.scrollTop || dBody.scrollTop; // Y value of current position.\n                // Print ovaerlay.\n                $(\"body\").append(\"<div id=\\\"selector_content\\\"></div>\");\n                $(\"body\").append(\"<div id=\\\"modal_window\\\"></div>\");\n                $(\"#modal_window\").fadeIn(\"slow\");\n\n                // Centering content.\n                centeringModalSyncer(\"#selector_content\");\n                // Fade-in content.\n                $(\"#selector_content\").fadeIn(\"slow\");\n                // Set url of content.\n                $(\"#selector_content\").html(\"<iframe src=\\\"\" + url + \"\\\" width=\\\"100%\\\" height=\\\"100%\\\">\");\n\n                // Cntering content.\n                centeringModalSyncer(\"#selector_content\");\n\n                $(parent.window).resize(function() {\n                    centeringModalSyncer(\"#selector_content\");\n                });\n\n                return true;\n            }\n\n            /**\n             * This function delete modal window.\n             * @access public\n             */\n            function fadeOutSelectorWindow() {\n\n                // Restore scroll position of base window.\n                window.scrollTo(modalX, modalY);\n\n                // Fade-out and delete modal contet and modal window.\n                $(\"#modal_window\", parent.document).fadeOut(\"slow\");\n                $(\"#modal_window\", parent.document).remove();\n                $(\"#selector_content\", parent.document).fadeOut(\"slow\");\n                $(\"#selector_content\", parent.document).remove();\n            }\n\n            /**\n             * This function is callback for OK button click.\n             * @access public\n             */\n            function selectorSubmitClick() {\n                // Get entry id of selected media.\n                var selectId = $(\"#select_id\").val();\n                // Get name of selected media.\n                var selectName = $(\"#select_name\").html();\n                // Get thumbnail of selected media.\n                var selectThumbnail = $(\"#select_thumbnail\").val();\n\n                if (selectId !== null && selectId !== \"\") {\n                    if ($(\"#entry_id\") !== null) {\n                        $(\"#entry_id\", parent.document).val($(\"#select_id\").val());\n                    }\n\n                    var idName = $(\"#id_name\", parent.document);\n\n                    if (idName !== null) {\n                        idName.val($(\"#select_name\").html());\n                    }\n\n                    var desc = \"\";\n\n                    var selectDesc = $(\"#description_\" + selectId);\n                    if (selectDesc !== null) {\n                        desc = selectDesc.html();\n                        desc = desc.replace(/\\n/g, \"<br />\");\n                    }\n\n                    desc = \"<p>\" + desc + \"<br /></p>\";\n\n                    var editor = $(\"#id_introeditoreditable\", parent.document);\n\n                    if (editor !== null) {\n                        if (desc !== null && desc !== \"\") {\n                            editor.html(desc);\n                        } else {\n                            editor.html(\"\");\n                        }\n                    }\n\n                    editor = $(\"#id_introeditor\", parent.document);\n\n                    if (editor !== null) {\n                        if (desc !== null && desc !== \"\") {\n                            editor.html(desc);\n                        } else {\n                            editor.html(\"\");\n                        }\n                    }\n\n                    if ($(\"#media_thumbnail\", parent.document) !== null) {\n                        $(\"#media_thumbnail\", parent.document).prop(\"src\", selectThumbnail);\n                        $(\"#media_thumbnail\", parent.document).prop(\"alt\", selectName);\n                        $(\"#media_thumbnail\", parent.document).prop(\"title\", selectName);\n                    }\n\n                    var idMediaProperties = $(\"#id_media_properties\", parent.document);\n                    if (idMediaProperties !== null) {\n                        idMediaProperties.css({visibility: \"visible\"});\n                    }\n\n                    var submitMedia = $(\"#submit_media\", parent.document);\n                    if (submitMedia !== null) {\n                        submitMedia.prop(\"disabled\", false);\n                    }\n\n                    // Fade-out modal windoiw.\n                    fadeOutSelectorWindow();\n                }\n            }\n\n            /**\n             * This function replaces \"Add Media\" label when membed media is selected.\n             * @access public\n             * @param {string} str - Label of \"Add Media\" button.\n             */\n            function replaceAddMediaLabel(str) {\n                $(\"#id_add_media\", parent.document).val(str);\n            }\n\n            $(\"#selectorSort\").on(\"change\", function() {\n                changeSort();\n            });\n\n            $(\"#id_add_media\").on(\"click\", function() {\n                fadeInSelectorWindow(selectorUrl);\n            });\n\n            $(\"#submit_btn\").on(\"click\", function() {\n                selectorSubmitClick();\n            });\n\n            $(\"#cancel_btn\").on(\"click\", function() {\n                fadeOutSelectorWindow();\n            });\n\n            $(\"#fadeout\").on(\"click\", function() {\n                fadeOutSelectorWindow();\n            });\n\n            if ($(location).attr(\"pathname\").indexOf(\"simple_selector.php\") != -1) {\n                $(\".media_thumbnail\").on(\"click\", function(e) {\n                    clickThumbnailImage(e);\n                });\n            } else {\n                $(\"#media_thumbnail\").on(\"change\", function() {\n                    replaceAddMediaLabel(replaceLabel);\n                });\n            }\n\n        }\n    };\n});\n"],"file":"simpleselector.min.js"}