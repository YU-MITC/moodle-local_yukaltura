{"version":3,"file":"properties.min.js","sources":["../src/properties.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Media properties script for kaltura media embed.\n *\n * @copyright (C) 2016-2025 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module local_yukaltura/properties\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initial function.\n         * @access public\n         * @param {string} propertiesUrl - url of media properties page.\n         * @param {string} invalidName - message for invalid  page name.\n         * @param {string} emptySize - message printed when player size is empty.\n         * @param {string} invalidCustomSize - message for invalid player size.\n         * @param {string} invalidSize - message for invalid size.\n         */\n        init: function(propertiesUrl, invalidName, emptySize, invalidCustomSize, invalidSize) {\n\n            var modalX = 0;\n            var modalY = 0;\n            var timer = false;\n\n            /**\n             * This function centerize modal window.\n             * @access public\n             * @param {object} contentPanel - HTML element of content panel.\n             */\n            function centeringModalSyncer(contentPanel) {\n                if (timer !== false) {\n                    clearTimeout(timer);\n                }\n                timer = setTimeout(function() {\n                    $(contentPanel).css({\"width\": \"550px\", \"height\": \"400px\"});\n                    $(contentPanel).css({\"font-size\": \"14px\"});\n\n                    // Get width and height of window.\n                    var w = $(window).width();\n                    var h = $(window).height();\n\n                    // Get width and height of modal content.\n                    var cw = $(contentPanel).outerWidth();\n                    var ch = $(contentPanel).outerHeight();\n\n                    // Execute centering of modal window.\n                    $(contentPanel).css({\"left\": ((w - cw) / 2) + \"px\", \"top\": ((h - ch) / 2) + \"px\"});\n                }, 200);\n            }\n\n            /**\n             * This function checks letter of name.\n             * @access public\n             * @param {string} str - media title\n             * @return {bool} - if check is passed, return \"true\". Otherwise return \"false\".\n             */\n            function checkNameString(str) {\n                var regex = /[\"$%&'~^\\\\`/]/;\n                if (regex.test(str) === true) {\n                    return false;\n                }\n\n                return true;\n            }\n\n            /**\n             * This function checks player size.\n             * @access public\n             * @param {int} width - player width set by user.\n             * @param {int} height - player height set by user.\n             * @return {bool} - if palyer size is appropriate, return \"true\". Otherwise return \"false\".\n             */\n            function checkPlayerDimension(width, height) {\n                if (width < 200 || height < 200) {\n                    return false;\n                } else if (width > 1280 || height > 1280) {\n                    return false;\n                }\n\n                return true;\n            }\n\n            /**\n             * This function print modal window of player properties.\n             * @access public\n             * @param {string} url - URL of selector page.\n             * @return {bool} - if fade-in modal window, return true;\n             */\n            function fadeInPropertiesWindow(url) {\n                // Avoidance of duplicatable execute.\n                $(this).blur(); // Unfocous.\n                if ($(\"#modal_window\")[0]) {\n                    return false;\n                }\n\n                // Save scroll position of base window.\n                var dElm = document.documentElement;\n                var dBody = document.body;\n                modalX = dElm.scrollLeft || dBody.scrollLeft; // X value of current position.\n                modalY = dElm.scrollTop || dBody.scrollTop; // Y value of current position.\n                // Print overlay.\n                $(\"body\").append(\"<div id=\\\"media_properties_panel\\\"></div>\");\n                $(\"body\").append(\"<div id=\\\"modal_window\\\"></div>\");\n                $(\"#modal_window\").fadeIn(\"slow\");\n\n                // Cetering content.\n                centeringModalSyncer(\"#media_properties_panel\");\n\n                $(\"#media_properties_panel\").fadeIn(\"slow\");\n                $(\"#media_properties_panel\").html(\"<iframe src=\\\"\" + url + \"\\\" width=\\\"100%\\\" height=\\\"100%\\\">\");\n\n                // Centering content.\n                centeringModalSyncer(\"#media_properties_panel\");\n\n                $(parent.window).resize(function() {\n                    centeringModalSyncer(\"#media_properties_panel\");\n                });\n\n                return true;\n            }\n\n            /**\n             * This function deletes modal window of player properties.\n             * @access public\n             */\n            function fadeOutPropertiesWindow() {\n\n                // Restore scroll position of base window.\n                window.scrollTo(modalX, modalY);\n\n                // Fade-out and delete modal window of player properties.\n                $(\"#modal_window\", parent.document).fadeOut(\"slow\");\n                $(\"#modal_window\", parent.document).remove();\n                $(\"#media_properties_panel\", parent.document).fadeOut(\"slow\");\n                $(\"#media_properties_panel\", parent.document).remove();\n            }\n\n            /**\n             * This function is callback for player dimension.\n             * @access public\n             */\n            function handlePlayerDimensionChange() {\n                var flag = false;\n                var widthStr = $(\"#media_prop_width\").val();\n                var heightStr = $(\"#media_prop_height\").val();\n                var regex = /^\\d{2,4}$/;\n                if (regex.test(widthStr) === true && regex.test(heightStr) === true) {\n                    var widthInt = parseInt(widthStr);\n                    var heightInt = parseInt(heightStr);\n                    flag = checkPlayerDimension(widthInt, heightInt);\n                }\n\n                if (flag === true) {\n                    $(\"#submit_btn\").prop(\"disabled\", false);\n                    $(\"#submit_btn\").css({opacity: \"1.0\"});\n                } else {\n                    $(\"#submit_btn\").prop(\"disabled\", true);\n                    $(\"#submit_btn\").css({opacity: \"0.5\"});\n                }\n            }\n\n            /**\n             * This function is callback for player dimension.\n             * @access public\n             */\n            function handlePlayerSizeSelect() {\n                var index = $(\"#media_prop_size\").prop(\"selectedIndex\");\n                if (index == $(\"#media_prop_size\").children(\"option\").length - 1) {\n                    $(\"#media_prop_width\").prop(\"disabled\", false);\n                    $(\"#media_prop_height\").prop(\"disabled\", false);\n                    $(\"#submit_btn\").prop(\"disabled\", true);\n                    $(\"#submit_btn\").css({opacity: \"0.5\"});\n                } else {\n                    $(\"#media_prop_width\").val(\"\");\n                    $(\"#media_prop_height\").val(\"\");\n                    $(\"#media_prop_width\").prop(\"disabled\", true);\n                    $(\"#media_prop_height\").prop(\"disabled\", true);\n                    $(\"#submit_btn\").prop(\"disabled\", false);\n                    $(\"#submit_btn\").css({opacity: \"1.0\"});\n                }\n            }\n\n            /**\n             * This function is callback for OK button on player properties window.\n             * @access public\n             * @return {bool} - if fade-out modal window, return true.\n             */\n            function propertiesSubmitClick() {\n                var str = $(\"#media_prop_name\").val();\n\n                str = str.trim();\n\n                if (checkNameString(str) === false) {\n                    window.alert(invalidName);\n                    return false;\n                }\n\n                var index = $(\"#media_prop_size\").prop(\"selectedIndex\");\n\n                var width = \"\";\n                var height = \"\";\n\n                if (index == $(\"#media_prop_size\").children(\"option\").length - 1) {\n                    if ($(\"#media_prop_width\").value === \"\" ||\n                        $(\"#media_prop_height\").value === \"\") {\n                        window.alert(emptySize);\n                        return false;\n                    } else {\n                        width = $(\"#media_prop_width\").val();\n                        height = $(\"#media_prop_height\").val();\n                        width = width.trim();\n                        height = height.trim();\n                        var regex = /^\\d{2,4}$/;\n                        if (regex.test(width) === false || regex.test(height) === false) {\n                            window.alert(invalidCustomSize);\n                            return false;\n                        }\n                    }\n                } else {\n                    var dimension = $(\"#media_prop_size option:selected\").text();\n                    var dimensionArray = dimension.match(/\\d{2,4}/g);\n                    if (dimensionArray === null || dimensionArray.length != 2) {\n                        window.alert(invalidSize);\n                        return false;\n                    }\n                    width = dimensionArray[0];\n                    height = dimensionArray[1];\n                }\n\n                if (checkPlayerDimension(parseInt(width), parseInt(height)) === false) {\n                    window.alert(invalidSize);\n                    return false;\n                }\n\n                $(\"#width\", parent.document).val(width);\n                $(\"#height\", parent.document).val(height);\n                $(\"media_title\", parent.document).val(str);\n                $(\"#uiconf_id\", parent.document).val($(\"#media_prop_player\").val());\n\n                // Delete modal window of player propertieds.\n                fadeOutPropertiesWindow();\n\n                return true;\n            }\n\n            /**\n             * This function describe module parameters to mod_form.\n             * @access public\n             */\n            function loadPropertiesParameter() {\n                $(\"#media_prop_name\").val($(\"#media_title\", parent.document).val());\n                var uiconfid = $(\"#uiconf_id\", parent.document).val();\n                var flag = false;\n                for (var i = 0; i < $(\"#media_prop_player\").children(\"option\").length; i++) {\n                    if ($(\"#media_prop_player option:eq(\" + i + \")\").val() == uiconfid) {\n                        $(\"#media_prop_player\").prop(\"selectedIndex\", i);\n                        flag = true;\n                    }\n                }\n\n                if (flag === false) {\n                    $(\"#media_prop_player\").prop(\"selectedIndex\", 0);\n                }\n\n                var width = $(\"#width\", parent.document).val();\n                var height = $(\"#height\", parent.document).val();\n                var dimension = width + 'x' + height;\n                $(\"#media_prop_width\").prop(\"disabled\", false);\n                $(\"#media_prop_height\").prop(\"disabled\", false);\n                if (width !== \"\" && width != \"0\" && height !== \"\" && height != \"0\") {\n                    for (var j = 0; j < $(\"#media_prop_size\").children(\"option\").length; j++) {\n                        if ($(\"#media_prop_size option:eq(\" + j + \")\").text().indexOf(dimension) != -1) {\n                            $(\"#media_prop_size\").prop(\"selectedIndex\", j);\n                            $(\"#media_prop_width\").prop(\"disabled\", true);\n                            $(\"#media_prop_height\").prop(\"disabled\", true);\n                        }\n                    }\n\n                    if ($(\"#media_prop_width\").prop(\"disabled\") === false) {\n                        var index = $(\"#media_prop_size\").children(\"option\").length - 1;\n                        $(\"#media_prop_size\").prop(\"selectedIndex\", index);\n                        $(\"#media_prop_width\").val(width);\n                        $(\"#media_prop_height\").val(height);\n                    }\n                } else {\n                    $(\"#media_prop_width\").val(\"\");\n                    $(\"#media_prop_height\").val(\"\");\n                    $(\"#media_prop_size\").prop(\"selectedIndex\", 0);\n                }\n            }\n\n            $(\"#id_media_properties\").on(\"click\", function() {\n                fadeInPropertiesWindow(propertiesUrl);\n            });\n\n            $(\"#media_prop_size\").on(\"change\", function() {\n                handlePlayerSizeSelect();\n            });\n\n            $(\"#media_prop_width\").on(\"change\", function() {\n                handlePlayerDimensionChange();\n            });\n\n            $(\"#media_prop_height\").on(\"change\", function() {\n                handlePlayerDimensionChange();\n            });\n\n            $(\"#submit_btn\").on(\"click\", function() {\n                propertiesSubmitClick();\n            });\n\n            $(\"#cancel_btn\").on(\"click\", function() {\n                fadeOutPropertiesWindow();\n            });\n\n            if ($(location).attr(\"pathname\").indexOf(\"media_properties.php\") != -1) {\n                loadPropertiesParameter();\n            }\n        }\n    };\n});\n"],"names":["define","$","init","propertiesUrl","invalidName","emptySize","invalidCustomSize","invalidSize","modalX","modalY","timer","centeringModalSyncer","contentPanel","clearTimeout","setTimeout","css","w","window","width","h","height","cw","outerWidth","ch","outerHeight","checkPlayerDimension","fadeOutPropertiesWindow","scrollTo","parent","document","fadeOut","remove","handlePlayerDimensionChange","flag","widthStr","val","heightStr","regex","test","parseInt","prop","opacity","on","url","this","blur","dElm","documentElement","dBody","body","scrollLeft","scrollTop","append","fadeIn","html","resize","fadeInPropertiesWindow","children","length","str","checkNameString","trim","alert","value","dimensionArray","text","match","propertiesSubmitClick","location","attr","indexOf","uiconfid","i","dimension","j","index","loadPropertiesParameter"],"mappings":"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"}