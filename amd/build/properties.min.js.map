{"version":3,"file":"properties.min.js","sources":["../src/properties.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Media properties script for kaltura media embed.\n *\n * @copyright (C) 2016-2023 Yamaguchi University (gh-cc@mlex.cc.yamaguchi-u.ac.jp)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module local_yukaltura/properties\n */\n\ndefine(['jquery'], function($) {\n\n    return {\n        /**\n         * Initial function.\n         * @access public\n         * @param {string} propertiesUrl - url of media properties page.\n         * @param {string} invalidName - message for invalid  page name.\n         * @param {string} emptySize - message printed when player size is empty.\n         * @param {string} invalidCustomSize - message for invalid player size.\n         * @param {string} invalidSize - message for invalid size.\n         */\n        init: function(propertiesUrl, invalidName, emptySize, invalidCustomSize, invalidSize) {\n\n            var modalX = 0;\n            var modalY = 0;\n            var timer = false;\n\n            /**\n             * This function centerize modal window.\n             * @access public\n             * @param {object} contentPanel - HTML element of content panel.\n             */\n            function centeringModalSyncer(contentPanel) {\n                if (timer !== false) {\n                    clearTimeout(timer);\n                }\n                timer = setTimeout(function() {\n                    $(contentPanel).css({\"width\": \"550px\", \"height\": \"400px\"});\n                    $(contentPanel).css({\"font-size\": \"14px\"});\n\n                    // Get width and height of window.\n                    var w = $(window).width();\n                    var h = $(window).height();\n\n                    // Get width and height of modal content.\n                    var cw = $(contentPanel).outerWidth();\n                    var ch = $(contentPanel).outerHeight();\n\n                    // Execute centering of modal window.\n                    $(contentPanel).css({\"left\": ((w - cw) / 2) + \"px\", \"top\": ((h - ch) / 2) + \"px\"});\n                }, 200);\n            }\n\n            /**\n             * This function checks letter of name.\n             * @access public\n             * @param {string} str - media title\n             * @return {bool} - if check is passed, return \"true\". Otherwise return \"false\".\n             */\n            function checkNameString(str) {\n                var regex = /[\"$%&'~^\\\\`/]/;\n                if (regex.test(str) === true) {\n                    return false;\n                }\n\n                return true;\n            }\n\n            /**\n             * This function checks player size.\n             * @access public\n             * @param {int} width - player width set by user.\n             * @param {int} height - player height set by user.\n             * @return {bool} - if palyer size is appropriate, return \"true\". Otherwise return \"false\".\n             */\n            function checkPlayerDimension(width, height) {\n                if (width < 200 || height < 200) {\n                    return false;\n                } else if (width > 1280 || height > 1280) {\n                    return false;\n                }\n\n                return true;\n            }\n\n            /**\n             * This function print modal window of player properties.\n             * @access public\n             * @param {string} url - URL of selector page.\n             * @return {bool} - if fade-in modal window, return true;\n             */\n            function fadeInPropertiesWindow(url) {\n                // Avoidance of duplicatable execute.\n                $(this).blur(); // Unfocous.\n                if ($(\"#modal_window\")[0]) {\n                    return false;\n                }\n\n                // Save scroll position of base window.\n                var dElm = document.documentElement;\n                var dBody = document.body;\n                modalX = dElm.scrollLeft || dBody.scrollLeft; // X value of current position.\n                modalY = dElm.scrollTop || dBody.scrollTop; // Y value of current position.\n                // Print overlay.\n                $(\"body\").append(\"<div id=\\\"media_properties_panel\\\"></div>\");\n                $(\"body\").append(\"<div id=\\\"modal_window\\\"></div>\");\n                $(\"#modal_window\").fadeIn(\"slow\");\n\n                // Cetering content.\n                centeringModalSyncer(\"#media_properties_panel\");\n\n                $(\"#media_properties_panel\").fadeIn(\"slow\");\n                $(\"#media_properties_panel\").html(\"<iframe src=\\\"\" + url + \"\\\" width=\\\"100%\\\" height=\\\"100%\\\">\");\n\n                // Centering content.\n                centeringModalSyncer(\"#media_properties_panel\");\n\n                $(parent.window).resize(function() {\n                    centeringModalSyncer(\"#media_properties_panel\");\n                });\n\n                return true;\n            }\n\n            /**\n             * This function deletes modal window of player properties.\n             * @access public\n             */\n            function fadeOutPropertiesWindow() {\n\n                // Restore scroll position of base window.\n                window.scrollTo(modalX, modalY);\n\n                // Fade-out and delete modal window of player properties.\n                $(\"#modal_window\", parent.document).fadeOut(\"slow\");\n                $(\"#modal_window\", parent.document).remove();\n                $(\"#media_properties_panel\", parent.document).fadeOut(\"slow\");\n                $(\"#media_properties_panel\", parent.document).remove();\n            }\n\n            /**\n             * This function is callback for player dimension.\n             * @access public\n             */\n            function handlePlayerDimensionChange() {\n                var flag = false;\n                var widthStr = $(\"#media_prop_width\").val();\n                var heightStr = $(\"#media_prop_height\").val();\n                var regex = /^\\d{2,4}$/;\n                if (regex.test(widthStr) === true && regex.test(heightStr) === true) {\n                    var widthInt = parseInt(widthStr);\n                    var heightInt = parseInt(heightStr);\n                    flag = checkPlayerDimension(widthInt, heightInt);\n                }\n\n                if (flag === true) {\n                    $(\"#submit_btn\").prop(\"disabled\", false);\n                    $(\"#submit_btn\").css({opacity: \"1.0\"});\n                } else {\n                    $(\"#submit_btn\").prop(\"disabled\", true);\n                    $(\"#submit_btn\").css({opacity: \"0.5\"});\n                }\n            }\n\n            /**\n             * This function is callback for player dimension.\n             * @access public\n             */\n            function handlePlayerSizeSelect() {\n                var index = $(\"#media_prop_size\").prop(\"selectedIndex\");\n                if (index == $(\"#media_prop_size\").children(\"option\").length - 1) {\n                    $(\"#media_prop_width\").prop(\"disabled\", false);\n                    $(\"#media_prop_height\").prop(\"disabled\", false);\n                    $(\"#submit_btn\").prop(\"disabled\", true);\n                    $(\"#submit_btn\").css({opacity: \"0.5\"});\n                } else {\n                    $(\"#media_prop_width\").val(\"\");\n                    $(\"#media_prop_height\").val(\"\");\n                    $(\"#media_prop_width\").prop(\"disabled\", true);\n                    $(\"#media_prop_height\").prop(\"disabled\", true);\n                    $(\"#submit_btn\").prop(\"disabled\", false);\n                    $(\"#submit_btn\").css({opacity: \"1.0\"});\n                }\n            }\n\n            /**\n             * This function is callback for OK button on player properties window.\n             * @access public\n             * @return {bool} - if fade-out modal window, return true.\n             */\n            function propertiesSubmitClick() {\n                var str = $(\"#media_prop_name\").val();\n\n                str = str.trim();\n\n                if (checkNameString(str) === false) {\n                    window.alert(invalidName);\n                    return false;\n                }\n\n                var index = $(\"#media_prop_size\").prop(\"selectedIndex\");\n\n                var width = \"\";\n                var height = \"\";\n\n                if (index == $(\"#media_prop_size\").children(\"option\").length - 1) {\n                    if ($(\"#media_prop_width\").value === \"\" ||\n                        $(\"#media_prop_height\").value === \"\") {\n                        window.alert(emptySize);\n                        return false;\n                    } else {\n                        width = $(\"#media_prop_width\").val();\n                        height = $(\"#media_prop_height\").val();\n                        width = width.trim();\n                        height = height.trim();\n                        var regex = /^\\d{2,4}$/;\n                        if (regex.test(width) === false || regex.test(height) === false) {\n                            window.alert(invalidCustomSize);\n                            return false;\n                        }\n                    }\n                } else {\n                    var dimension = $(\"#media_prop_size option:selected\").text();\n                    var dimensionArray = dimension.match(/\\d{2,4}/g);\n                    if (dimensionArray === null || dimensionArray.length != 2) {\n                        window.alert(invalidSize);\n                        return false;\n                    }\n                    width = dimensionArray[0];\n                    height = dimensionArray[1];\n                }\n\n                if (checkPlayerDimension(parseInt(width), parseInt(height)) === false) {\n                    window.alert(invalidSize);\n                    return false;\n                }\n\n                $(\"#width\", parent.document).val(width);\n                $(\"#height\", parent.document).val(height);\n                $(\"media_title\", parent.document).val(str);\n                $(\"#uiconf_id\", parent.document).val($(\"#media_prop_player\").val());\n\n                // Delete modal window of player propertieds.\n                fadeOutPropertiesWindow();\n\n                return true;\n            }\n\n            /**\n             * This function describe module parameters to mod_form.\n             * @access public\n             */\n            function loadPropertiesParameter() {\n                $(\"#media_prop_name\").val($(\"#media_title\", parent.document).val());\n                var uiconfid = $(\"#uiconf_id\", parent.document).val();\n                var flag = false;\n                for (var i = 0; i < $(\"#media_prop_player\").children(\"option\").length; i++) {\n                    if ($(\"#media_prop_player option:eq(\" + i + \")\").val() == uiconfid) {\n                        $(\"#media_prop_player\").prop(\"selectedIndex\", i);\n                        flag = true;\n                    }\n                }\n\n                if (flag === false) {\n                    $(\"#media_prop_player\").prop(\"selectedIndex\", 0);\n                }\n\n                var width = $(\"#width\", parent.document).val();\n                var height = $(\"#height\", parent.document).val();\n                var dimension = width + 'x' + height;\n                $(\"#media_prop_width\").prop(\"disabled\", false);\n                $(\"#media_prop_height\").prop(\"disabled\", false);\n                if (width !== \"\" && width != \"0\" && height !== \"\" && height != \"0\") {\n                    for (var j = 0; j < $(\"#media_prop_size\").children(\"option\").length; j++) {\n                        if ($(\"#media_prop_size option:eq(\" + j + \")\").text().indexOf(dimension) != -1) {\n                            $(\"#media_prop_size\").prop(\"selectedIndex\", j);\n                            $(\"#media_prop_width\").prop(\"disabled\", true);\n                            $(\"#media_prop_height\").prop(\"disabled\", true);\n                        }\n                    }\n\n                    if ($(\"#media_prop_width\").prop(\"disabled\") === false) {\n                        var index = $(\"#media_prop_size\").children(\"option\").length - 1;\n                        $(\"#media_prop_size\").prop(\"selectedIndex\", index);\n                        $(\"#media_prop_width\").val(width);\n                        $(\"#media_prop_height\").val(height);\n                    }\n                } else {\n                    $(\"#media_prop_width\").val(\"\");\n                    $(\"#media_prop_height\").val(\"\");\n                    $(\"#media_prop_size\").prop(\"selectedIndex\", 0);\n                }\n            }\n\n            $(\"#id_media_properties\").on(\"click\", function() {\n                fadeInPropertiesWindow(propertiesUrl);\n            });\n\n            $(\"#media_prop_size\").on(\"change\", function() {\n                handlePlayerSizeSelect();\n            });\n\n            $(\"#media_prop_width\").on(\"change\", function() {\n                handlePlayerDimensionChange();\n            });\n\n            $(\"#media_prop_height\").on(\"change\", function() {\n                handlePlayerDimensionChange();\n            });\n\n            $(\"#submit_btn\").on(\"click\", function() {\n                propertiesSubmitClick();\n            });\n\n            $(\"#cancel_btn\").on(\"click\", function() {\n                fadeOutPropertiesWindow();\n            });\n\n            if ($(location).attr(\"pathname\").indexOf(\"media_properties.php\") != -1) {\n                loadPropertiesParameter();\n            }\n        }\n    };\n});\n"],"names":["define","$","init","propertiesUrl","invalidName","emptySize","invalidCustomSize","invalidSize","modalX","modalY","timer","centeringModalSyncer","contentPanel","clearTimeout","setTimeout","css","width","height","w","window","h","cw","outerWidth","ch","outerHeight","left","top","checkPlayerDimension","fadeOutPropertiesWindow","scrollTo","parent","document","fadeOut","remove","handlePlayerDimensionChange","flag","widthStr","val","heightStr","regex","test","parseInt","prop","opacity","on","url","this","blur","dElm","documentElement","dBody","body","scrollLeft","scrollTop","append","fadeIn","html","resize","fadeInPropertiesWindow","children","length","str","checkNameString","trim","alert","value","dimensionArray","text","match","propertiesSubmitClick","location","attr","indexOf","uiconfid","i","dimension","j","index","loadPropertiesParameter"],"mappings":"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"}